<!DOCTYPE html>
<html lang="en">
<head>
	
	<!-- start: Meta -->
	<meta charset="utf-8">
	<title>Bright Apparel - Invoice Management System</title>
	<% include partials/head.html %>		
	<!-- start: Custom JavaScript-->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="/javascripts/invoice/events.js"></script>

	<script type="text/javascript">
	  var count = 0;

	  $(document).ready(function() {
	  	
	  	var isProductLoaded = false;
	  	
	  	var rowAdded = false;

		$('table#myTable').dataTable({
		  'bFilter': false,
		  'bInfo': false,
		  'bPaginate': false,
		});

		// Add initial row
		addRow();
	  } );

	  function addRow() {
	  	var productTaxable = {};
	  	$.ajax({
			type: "GET",
			url:  "/product/list",
			success: function (data) {
				rowAdded = true;
				isProductLoaded = true;
				var seletedProductId;

				var htmlArray = [];
				htmlArray.push('<option value="" selected="selected">Select Product</option>');
				for(var i = 0; i < $(data).size(); i++) {
					productTaxable[data[i].id] = data[i].taxable;
					htmlArray.push('<option value="' + data[i].id + '">' + data[i].name + '</option>');
				}
				var htmlString = htmlArray.join("");

				$('table#myTable').dataTable().fnAddData([
				  '<select required="required" id="selectProduct_' + count + '">' + htmlString + '</select>',
				  '<input type="text" style="width: 300px;" id="description_' + count + '" value="0" name="description_' + count + '">',
				  '<input type="text" style="width: 50px;" id="quantity_' + count + '" value="0" name="quantity_' + count + '">',
				  '<input type="text" style="width: 50px;" id="rate_' + count + '" value="0" name="rate_' + count + '">',
				  '<input type="text" style="width: 100px;" id="vat_amount_' + count + '" value="0" name="vat_amount_' + count + '">',
				  '<input type="text" style="width: 100px;" id="non_vat_amount_' + count + '" value="0" name="non_vat_amount_' + count + '">']);

				//var row = productTable.fnGetNodes(rowIndex);

				$('#selectProduct_' + count).on('change', function() {
					seletedProductId = $(this).val();
					var taxable = productTaxable[seletedProductId];
					if(taxable) {
						$('#non_vat_amount_' + count).attr('disabled', true);
						$('#vat_amount_' + count).attr('disabled', false);
					} else {
						$('#vat_amount_' + count).attr('disabled', true);
						$('#non_vat_amount_' + count).attr('disabled', false);
					}
				});

				$('#quantity_' + count).on('input', function(event) {
					console.log('INSIDE KEYPRESS QUANTITY');
					var quantity = $(this).val();
					var rate = $('#rate_' + count).val();
					var totalAmount = quantity * rate;
					if($('#non_vat_amount_' + count).attr('disabled')) {
						$('#vat_amount_' + count).val(totalAmount);
						$('#non_vat_amount_' + count).val("0");
					} else if($('#vat_amount_' + count).attr('disabled')) {
						$('#non_vat_amount_' + count).val(totalAmount);
						$('#vat_amount_' + count).val("0");
					}
				});

				$('#rate_' + count).on('input', function(event) {
					var quantity = $('#quantity_' + count).val();
					var rate = $(this).val();
					var totalAmount = quantity * rate;
					if($('#non_vat_amount_' + count).attr('disabled')) {
						$('#vat_amount_' + count).val(totalAmount);
						$('#non_vat_amount_' + count).val("0");
					} else if($('#vat_amount_' + count).attr('disabled')) {
						$('#non_vat_amount_' + count).val(totalAmount);
						$('#vat_amount_' + count).val("0");
					}
				});
			},
			error: function(jqXHR, textStatus, errorthrown) {
				console.log("EVENT JS ERROR THROWN: "+errorthrown);
			}
		});
		count++;
	  }

	  function deleteRow () {
		if (count != 1) {
			var row_index = $('#myTable').find('tr');
			//alert('Current Index'+ row_index);
			$("table#myTable").dataTable().fnDeleteRow(count - 1);

			count--;
		}
	  }
	</script>
		
<!-- end: Custom JavaScript-->
</head>

<body>
		<!-- start: Navigation Bar -->
		<% include partials/navbar.html %>
		<!-- end: Navigation Bar -->
		<div class="container-fluid-full">
		<div class="row-fluid">
				
			<!-- start: Side Bar Menu -->
			<% include partials/sidebar.html %>
			<!-- end: Side Bar Menu -->			
			
			<noscript>
				<div class="alert alert-block span10">
					<h4 class="alert-heading">Warning!</h4>
					<p>You need to have <a href="http://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a> enabled to use this site.</p>
				</div>
			</noscript>
			
			<!-- start: Content -->
			<div id="content" class="span10">
			
			<!--- BREAD CRUM -->
			
			<ul class="breadcrumb">
				<li>
					<i class="icon-home"></i>
					<a href="index.html">Home</a>
					<i class="icon-angle-right"></i> 
				</li>
				<li>
					<i class="icon-edit"></i>
					<a href="#">Invoice</a>
				</li>
			</ul>
			<!--- END OF BREAD CRUM -->
			
			<!-- INVOICE FORM -->
			
			<div class="row-fluid sortable">
				<div class="box span12">
					<div class="box-header" data-original-title>
						<h2><i class="halflings-icon white edit"></i><span class="break"></span>Invoice Form</h2>
						<!-- <div class="box-icon">
							<a href="#" class="btn-setting"><i class="halflings-icon white wrench"></i></a>
							<a href="#" class="btn-minimize"><i class="halflings-icon white chevron-up"></i></a>
							<a href="#" class="btn-close"><i class="halflings-icon white remove"></i></a>
						</div> -->
					</div>
					<div class="box-content">
						<form class="form-horizontal">
							<fieldset>
							
							  <div class="form-actions" style="margin-bottom: 10px;"">
								<label class="control-label" for="focusedInput" style="font-weight: bold;font-size: 20px;padding-left: 200px;"> Client Details </label>
							  </div>
							  <div class="control-group">
								<label class="control-label" for="focusedInput">Name :</label>
								<div class="controls">
								  <select id="selectError" data-rel="chosen">
									<option>Option 1</option>
									<option>Option 2</option>
									<option>Option 3</option>
									<option>Option 4</option>
									<option>Option 5</option>
								  </select>
								</div>
								
							  </div>
							  
							  <div class="control-group">
								<label class="control-label" for="focusedInput">Address Line 1 :</label>
								<div class="controls">
								  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
								</div>

							  </div>
							  
							  <div class="control-group">
								<label class="control-label" for="focusedInput">Address Line 2 :</label>
								<div class="controls">
								  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
								</div>
							  </div>
							  
							  <div class="control-group">
								<label class="control-label" for="focusedInput">Address Line 3 :</label>
								<div class="controls">
								  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
								</div>
							  </div>
							  
							  <div class="control-group">
								<label class="control-label" for="focusedInput">City :</label>
								<div class="controls">
								  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
								</div>
							  </div>
							</fieldset>
							
							<fieldset>
								<div class="form-actions" style="margin-bottom: 10px;"">
									<label class="control-label" for="focusedInput" style="font-weight: bold;font-size: 20px;padding-left: 200px;"> Billing Details </label>
								</div>

								 <div class="control-group">
									<label class="control-label" for="focusedInput">Challan No. :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								  </div>
								  
								  <div class="control-group">
									<label class="control-label" for="focusedInput">Challan Date. :</label>
									<div class="controls">
									  <input type="text" class="input-xlarge datepicker" id="date01" value="02/16/12">
									</div>
								  </div>
								  
								  <div class="control-group">
									<label class="control-label" for="focusedInput">Order No. :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								  </div>
								  
								  <div class="control-group">
									<label class="control-label" for="focusedInput">Order Date. :</label>
									<div class="controls">
									  <input type="text" class="input-xlarge datepicker" id="date01" value="02/16/12">
									</div>
								  </div>
								  
								  <div class="control-group">
									<label class="control-label" for="focusedInput">Invoice No. :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								  </div>
								  
								  <div class="control-group">
									<label class="control-label" for="focusedInput">Invoice Date. :</label>
									<div class="controls">
									  <input type="text" class="input-xlarge datepicker" id="date01" value="02/16/12">
									</div>
								  </div>
								  
								  
								 
							</fieldset>
							
							<fieldset>
								<div class="form-actions" style="margin-bottom: 10px;"">
									<label class="control-label" for="focusedInput" style="font-weight: bold;font-size: 20px;padding-left:200px;"> Particulars </label>
								</div>
								<div id="controlButtons">
								  <button onclick="addRow();">Add row</button>
								  <button onclick="deleteRow();">Delete row</button>
								</div>
								  <table id="myTable" cellspacing="10">
									<thead>
									  <tr>
										<th>Product Name</th>
										<th>Description</th>
										<th>Quanity</th>
										<th>Rate</th>
										<th>Vat Amount</th>
										<th>Non Vat Amount</th>
									  </tr>
									</thead>
									<tbody>
									</tbody>
								  </table>
								
							</fieldset>
							
							<fieldset>
								<div class="form-actions" style="margin-bottom: 10px;"">
									<label class="control-label" for="focusedInput" style="font-weight: bold;font-size: 20px;padding-left: 200px;"> Billing Amount </label>
								</div>
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Gross Amount :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Gross Non VAT Amount :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Sub Total :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Packaging and Forwarding :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Sub Total :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Tax :</label>
									<div class="controls">
									  <select id="selectError3" style="width: 196px;">
										<option>Option 1</option>
										<option>Option 2</option>
										<option>Option 3</option>
										<option>Option 4</option>
										<option>Option 5</option>
									  </select>
									   <input class="input-xlarge focused" style="width: 70px;" id="focusedInput" type="text" value="">
									   <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Transport Type :</label>
									<div class="controls">
									  <select id="selectError3" style="width: 196px;">
										<option>Option 1</option>
										<option>Option 2</option>
										<option>Option 3</option>
										<option>Option 4</option>
										<option>Option 5</option>
									  </select>
									   <input class="input-xlarge focused" style="width: 70px;" id="focusedInput" type="text" value="">
									   <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Net Amount :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="focusedInput"> Amount in Words :</label>
									<div class="controls">
									  <input class="input-xlarge focused" id="focusedInput" type="text" value="">
									</div>
								</div>
							</fieldset>
							
							<fieldset>
								<div class="form-actions">
									<button type="submit" class="btn btn-primary">Save changes</button>
									<button class="btn">Cancel</button>
								</div>
							</fieldset>
							
						  </form>
					
					</div>
				</div>
			
			</div>
			
			

	</div><!--/.fluid-container-->
	
			<!-- end: Content -->
		</div><!--/#content.span10-->
		</div><!--/fluid-row-->
		
	<div class="modal hide fade" id="myModal">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">Ã—</button>
			<h3>Settings</h3>
		</div>
		<div class="modal-body">
			<p>Here settings can be configured...</p>
		</div>
		<div class="modal-footer">
			<a href="#" class="btn" data-dismiss="modal">Close</a>
			<a href="#" class="btn btn-primary">Save changes</a>
		</div>
	</div>
	
	<div class="clearfix"></div>
	
	<!-- start: Footer-->
	<% include partials/footer.html %>
	<!-- end: Footer-->

	<!-- start: JavaScript-->
	<% include partials/scripts.html %>
	<!-- end: JavaScript-->

	
</body>
</html>
